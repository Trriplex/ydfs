DOCKER_COMPOSE  = $(shell which docker-compose)
ifeq ($(DOCKER_COMPOSE),)
COMPOSE=docker compose
else
COMPOSE=docker-compose
endif


DOCKER_OPTIONS=run ydfs2.12 bash
BUILD_COMMAND=install -d /tmp/ydfs;cp -a 2.12/* /tmp/ydfs;cp /tmp/ydfs/init-x86/etc/profile /home/linuxconsole2026/.bashrc;cd /tmp/ydfs;

OPTION_BUILD=DIBAB_VERBOSE_BUILD=YES BUILDME=OK
OPTION_BUILD=MENUCONFIG=YES
OPTION_BUILD=DIBAB_VERBOSE_BUILD=YES
OPTION_BUILD=

initramfs-docker: busybox-docker
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make initramfs'

linux-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make linux'

busybox-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make busybox'

sh-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} /usr/bin/sh'

bash-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} bash'

opkg-docker:
	chmod 777 ${HOME}/.ncftp/bookmarks
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} DISTRONAME=all BUILDOPKG=YES make opkg'
	ls -l  ${HOME}/2.12-modules/ydfs/opkg/
	chmod 700 ${HOME}/.ncftp/bookmarks

buildenv-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make buildenv'

multilib-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make multilib'

mate-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make mate'

kodi-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make kodi'

kde-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make kde'

iso-verbose-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} DIBAB_VERBOSE_BUILD="YES"  make iso'

virtualbox-docker:
	#docker compose run -t -i ydfs2.12-modules-fast64 bash -c '${BUILD_COMMAND} ${OPTION_BUILD}BUILDME=OK make virtualbox'
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make virtualbox'

iso-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make iso'

updates-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make updates'

live-test-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make live-test'

devtools-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make devtools'

openxr-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make openxr'

iso-devtools-docker:
	DISTRONAME=devtools ${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make iso'

touch-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c 'touch /home/linuxconsole2026/x86_64/buildenv'
	${COMPOSE} ${DOCKER_OPTIONS} -c 'touch /home/linuxconsole2026/ydfs/build-x86_64/61810'
	${COMPOSE} ${DOCKER_OPTIONS} -c 'touch /home/linuxconsole2026/ydfs/build-x86_64/k61810'
	${COMPOSE} ${DOCKER_OPTIONS} -c 'touch /home/linuxconsole2026/ydfs/build/linux-x86_64-6.18.10/arch/x86_64/boot/bzImage'
	${COMPOSE} ${DOCKER_OPTIONS} -c 'touch /home/linuxconsole2026/ydfs/build/modules/linuxconsole-x86_64.squashfs'
	${COMPOSE} ${DOCKER_OPTIONS} -c 'touch /home/linuxconsole2026/ydfs/build/modules/kde-x86_64.squashfs'
	${COMPOSE} ${DOCKER_OPTIONS} -c 'touch /home/linuxconsole2026/ydfs/build/modules/mate-x86_64.squashfs'

gamejam-docker:
	DISTRONAME=gamejam ${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make iso'

clean-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make clean '

uninstall-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} make uninstall '

buildme-docker:
	${COMPOSE} ${DOCKER_OPTIONS} -c '${BUILD_COMMAND} ${OPTION_BUILD} BUILDME=OK make iso'


